name: Sync to Alist via WebDAV

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  sync_to_alist:
    runs-on: ubuntu-latest
    steps:
      # Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v2

      # 7. å®‰è£… rclone (ä¿æŒä¸å˜)
      - name: ğŸš€ Install rclone
        run: |
          curl https://rclone.org/install.sh | sudo bash

      # 8. é…ç½® rclone for WebDAV (Alist) (ä¿æŒä¸å˜)
      - name: âš™ï¸ Configure rclone for WebDAV (Alist)
        run: |
          # è¯·æ³¨æ„ï¼Œ/dav æ˜¯ Alist WebDAV çš„é»˜è®¤è·¯å¾„ï¼Œå¦‚æœæ‚¨çš„é…ç½®ä¸åŒè¯·ä¿®æ”¹
          rclone config create alist_webdav webdav \
            url https://${{ secrets.WEBDAV_HOST }}:${{ secrets.WEBDAV_PORT }}/dav \
            user ${{ secrets.ALIST_USERNAME }} \
            pass ${{ secrets.ALIST_PASSWORD }}

      # 9. æ›¿æ¢æ–‡ä»¶åˆ°ç›®æ ‡ç›®å½• (ä¿æŒä¸å˜)
      - name: ğŸ“¤ Copy build files to Alist WebDAV
        run: |
          rclone copy Custom.xaml alist_webdav:/ --checksum --size-only --retries 3
          rclone copy Custom.xaml.ini alist_webdav:/ --checksum --size-only --retries 3
          rclone copy Custom.json alist_webdav:/ --checksum --size-only --retries 3

      # 10. æ¸…ç† rclone é…ç½® (ä¿æŒä¸å˜)
      - name: ğŸ§¹ Clean up rclone config
        if: always()
        run: rm -rf ~/.config/rclone
